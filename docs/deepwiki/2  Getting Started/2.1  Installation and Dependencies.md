# Installation and Dependencies

Relevant source files

- [Makefile](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile)
- [README.md](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md)
- [uv.lock](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/uv.lock)

## Purpose and Scope

This page documents the installation process, dependency management, and infrastructure setup required to run the Adeline inference system. It covers package installation using `uv`, infrastructure service deployment (MQTT broker, RTSP proxy), and dependency verification.

For configuration of `.env` and `config.yaml` files, see [Configuration Setup](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/2.2-configuration-setup). For running your first pipeline after installation, see [Running Your First Pipeline](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/2.3-running-your-first-pipeline).

---

## Prerequisites

### System Requirements

|Requirement|Specification|Notes|
|---|---|---|
|**Python Version**|`>= 3.12.0`|Defined in [uv.lock4](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/uv.lock#L4-L4)|
|**Operating System**|macOS, Linux (aarch64/x86_64), Windows|Multi-platform support|
|**Memory**|4GB+ RAM recommended|For YOLO model inference|
|**Docker**|Docker Compose v2+|For infrastructure services|
|**Network**|Internet access|For Roboflow API (optional), MQTT broker|

### Required Tools

```
# uv (package manager) - must be installed first
curl -LsSf https://astral.sh/uv/install.sh | sh

# Docker and Docker Compose
# Installation varies by platform - see docker.com
```

**Sources:** [uv.lock3-9](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/uv.lock#L3-L9) [README.md56-64](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L56-L64)

---

## Package Management with uv

The project uses `uv` as its package manager instead of `pip` or `poetry`. The `uv` tool provides fast, reliable dependency resolution with a lock file for reproducible builds.

### Installation Workflow

**Diagram:** Installation workflow from user command to installed packages

### Makefile Installation Commands

The [Makefile52-70](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L52-L70) provides several installation targets:

```
# Standard installation (production dependencies)
make install

# Development installation (includes all extras)
make install-dev

# Upgrade inference package to latest version
make upgrade-inference

# Check for outdated dependencies
make check-deps
```

These commands internally call `uv sync` with appropriate flags ([Makefile54](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L54-L54) [Makefile59](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L59-L59)).

**Sources:** [Makefile52-70](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L52-L70) [Makefile18-19](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L18-L19)

---

## Core Dependencies

### Primary Dependencies

The project's core dependencies are defined in [pyproject.toml](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/pyproject.toml) and locked in [uv.lock12-36](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/uv.lock#L12-L36) The main package is registered as `251021` (project name) with version `0.1.0`.

|Package|Version|Purpose|
|---|---|---|
|`inference`|`>= 0.58.2`|Roboflow inference SDK, YOLO model support|
|`inference-cli`|`>= 0.58.2`|Command-line tools for inference operations|
|`inference-sdk`|`>= 0.58.2`|SDK for Roboflow cloud inference|
|`paho-mqtt`|`>= 1.6.1, < 1.7`|MQTT client for control/data planes|
|`python-dotenv`|`>= 1.0.0`|Environment variable loading from `.env`|
|`pyyaml`|`>= 6.0.1`|YAML parsing for `config.yaml`|
|`supervision`|`>= 0.26.1`|Computer vision utilities, detection processing|
|`ultralytics`|`>= 8.3.218`|YOLO models, inference engine|

**Sources:** [uv.lock12-36](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/uv.lock#L12-L36) [README.md164-171](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L164-L171)

### Dependency Tree

**Diagram:** Dependency relationships between application layers and external packages

### Transitive Dependencies

The `uv.lock` file contains over 100 transitive dependencies. Key categories include:

- **Computer Vision:** `opencv-python`, `numpy`, `pillow`, `contourpy`, `matplotlib`
- **Networking:** `aiohttp`, `httpx`, `urllib3`, `requests`, `websockets`
- **ML/AI:** `torch`, `torchvision`, `onnxruntime`, `tensorboard`
- **Data Processing:** `pandas`, `scipy`, `scikit-learn`
- **Async I/O:** `asyncio`, `aiofiles`, `aiosqlite`
- **WebRTC/Streaming:** `aiortc`, `aioice`, `av`
- **Cloud APIs:** `boto3`, `anthropic`, `google-crc32c`

**Sources:** [uv.lock38-600](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/uv.lock#L38-L600)

---

## Infrastructure Services

### Service Architecture

**Diagram:** Infrastructure services and their connections

### MQTT Broker (Mosquitto)

The MQTT broker is required for the control and data planes to communicate. It is deployed using Docker Compose.

**Docker Compose Configuration:**

```
# Start MQTT broker
make services-up

# Check service status
make services-status

# View logs
make services-logs

# Stop services
make services-down
```

These commands use [docker/adeline/docker-compose.mqtt.yml](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/docker/adeline/docker-compose.mqtt.yml) with configuration from [docker/adeline/mosquitto.conf](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/docker/adeline/mosquitto.conf)

**Default Connection:**

- **Host:** `localhost`
- **Port:** `1883`
- **Protocol:** MQTT v3.1.1

**Sources:** [Makefile130-151](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L130-L151) [README.md183-199](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L183-L199)

### RTSP Proxy (go2rtc) - Optional

The `go2rtc` service provides RTSP stream proxying and transcoding. Configuration is in [config/adeline/go2rtc.yaml](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/config/adeline/go2rtc.yaml)

This service is optional and only required if using RTSP video sources. It is not started automatically by `make services-up`.

**Sources:** [README.md13](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L13-L13) [README.md199](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L199-L199)

---

## Installation Process

### Step-by-Step Installation

**Diagram:** Installation sequence from empty environment to verified setup

### Command Sequence

```
# 1. Install uv package manager (if not already installed)
curl -LsSf https://astral.sh/uv/install.sh | sh

# 2. Clone repository
git clone https://github.com/care-foundation/kata-inference-251021-clean2
cd kata-inference-251021-clean2

# 3. Install Python dependencies
make install
# Output: Installing dependencies...
#         ✅ Dependencies installed

# 4. Start infrastructure services
make services-up
# Output: Starting Adeline infrastructure services...
#         ✅ Services started (mosquitto)
#         MQTT Broker: localhost:1883

# 5. Verify installation
make test-imports
# Output: Testing imports...
#         ✅ Core imports OK
#         ✅ Control plane OK
#         ✅ Data plane OK
#         ✅ ROI OK
#         ✅ Stabilization OK
#         ✅ All imports successful
```

**Sources:** [README.md56-76](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L56-L76) [Makefile52-65](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L52-L65) [Makefile130-134](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L130-L134) [Makefile163-170](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L163-L170)

### Alternative: Development Setup

For development with all optional dependencies:

```
# Install with development extras
make install-dev

# Combined setup (services + dependencies)
make dev
```

The `make dev` command is a workflow that combines `services-up` and `install` ([Makefile223-225](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L223-L225)).

**Sources:** [Makefile57-60](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L57-L60) [Makefile223-225](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L223-L225)

---

## Verification

### Import Tests

The [Makefile163-170](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L163-L170) provides an automated verification command:

```
make test-imports
```

This command tests imports for all major components:

|Component|Import Statement|File Location|
|---|---|---|
|**Core Config**|`from adeline import PipelineConfig`|[adeline/__init__.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/__init__.py) [adeline/config.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/config.py)|
|**Control Plane**|`from adeline.control import MQTTControlPlane`|[adeline/control/plane.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control/plane.py)|
|**Data Plane**|`from adeline.data import MQTTDataPlane`|[adeline/data/plane.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/data/plane.py)|
|**ROI**|`from adeline.inference.roi import ROIBox`|[adeline/inference/roi/](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/inference/roi/)|
|**Stabilization**|`from adeline.inference.stabilization import TemporalHysteresisStabilizer`|[adeline/inference/stabilization/](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/inference/stabilization/)|

**Sources:** [Makefile163-170](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L163-L170)

### Service Verification

Verify MQTT broker is running:

```
# Check Docker containers
docker ps

# Expected output should include:
# CONTAINER ID   IMAGE                    STATUS
# <id>           eclipse-mosquitto:2.0    Up X seconds

# Check service status
make services-status
```

Test MQTT connectivity:

```
# Subscribe to test topic (in terminal 1)
mosquitto_sub -h localhost -t test/topic

# Publish to test topic (in terminal 2)
mosquitto_pub -h localhost -t test/topic -m "hello"

# Terminal 1 should receive "hello"
```

**Sources:** [Makefile144-145](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L144-L145) [README.md198](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L198-L198)

### Python Environment Verification

```
# Verify Python version
.venv/bin/python --version
# Should output: Python 3.12.x or higher

# Check installed packages
.venv/bin/python -m pip list | grep inference
# Should show: inference, inference-cli, inference-sdk

# Verify uv environment
uv pip list --outdated
# Shows any outdated packages
```

**Sources:** [uv.lock3](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/uv.lock#L3-L3) [Makefile18](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L18-L18) [Makefile67-69](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L67-L69)

---

## Troubleshooting Common Issues

### Issue: uv Command Not Found

**Symptom:** `bash: uv: command not found` when running `make install`

**Solution:**

```
# Install uv
curl -LsSf https://astral.sh/uv/install.sh | sh

# Reload shell
source ~/.bashrc  # or ~/.zshrc

# Verify installation
uv --version
```

### Issue: Docker Services Won't Start

**Symptom:** `make services-up` fails with Docker connection error

**Solution:**

```
# Verify Docker is running
docker info

# If Docker daemon not running, start it:
# On macOS: Start Docker Desktop
# On Linux: sudo systemctl start docker

# Check port 1883 is available
lsof -i :1883
# If occupied, stop conflicting service or change port in docker-compose.mqtt.yml
```

**Sources:** [Makefile130-134](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L130-L134)

### Issue: Import Errors After Installation

**Symptom:** `ModuleNotFoundError` when running `make test-imports`

**Solution:**

```
# Ensure virtual environment is activated
source .venv/bin/activate

# Reinstall dependencies
make clean
make install

# If still failing, check Python version
python --version  # Must be 3.12+

# Try development installation
make install-dev
```

**Sources:** [Makefile183-194](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L183-L194) [Makefile163-170](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L163-L170)

### Issue: MQTT Connection Refused

**Symptom:** Pipeline fails with "Connection refused" on localhost:1883

**Solution:**

```
# 1. Verify services are running
make services-status

# 2. Check logs for errors
make services-logs

# 3. Restart services
make services-down
make services-up

# 4. Verify port is listening
netstat -an | grep 1883

# 5. Check mosquitto.conf configuration
cat docker/adeline/mosquitto.conf
```

**Sources:** [Makefile136-151](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L136-L151) [docker/adeline/mosquitto.conf](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/docker/adeline/mosquitto.conf)

### Issue: Model Download Failures

**Symptom:** Inference fails with model download errors

**Solution:**

```
# 1. Check internet connectivity
ping -c 3 google.com

# 2. Verify Roboflow API key in .env
cat .env | grep ROBOFLOW_API_KEY

# 3. Use local models instead (edit config.yaml)
# Set use_local: true for models

# 4. Check proxy settings if behind firewall
export HTTP_PROXY=<proxy_url>
export HTTPS_PROXY=<proxy_url>
```

**Sources:** [.env.example](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/.env.example) [config/adeline/config.yaml](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/config/adeline/config.yaml)

---

## Next Steps

After successful installation and verification:

1. **Configuration:** Set up `.env` and `config.yaml` files. See [Configuration Setup](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/2.2-configuration-setup)
2. **First Run:** Start the inference pipeline. See [Running Your First Pipeline](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/2.3-running-your-first-pipeline)
3. **Architecture:** Understand the system design. See [System Architecture](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/3-system-architecture)

**Sources:** [README.md54-102](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L54-L102) [Makefile74-111](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L74-L111)