# Makefile Command Reference

Relevant source files

- [Makefile](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile)
- [README.md](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md)

## Purpose and Scope

This document provides a complete reference for all `make` commands available in the KataInference project. The Makefile serves as the primary operational interface for installing dependencies, running the inference pipeline, controlling pipeline behavior, monitoring data streams, and managing infrastructure services.

For detailed information about the control commands themselves (pause, resume, stop, etc.), see [Control Commands](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.2-control-commands). For monitoring data streams and interpreting output, see [Monitoring and Data Streams](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.3-monitoring-and-data-streams). For infrastructure service management, see [Infrastructure Services](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.4-infrastructure-services).

**Sources:** [Makefile1-240](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L1-L240) [README.md54-103](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L54-L103)

---

## Makefile Architecture

The Makefile implements a **modular, namespace-based architecture** designed to support multiple inference modules (currently `adeline`, with `cupertino` planned for future). Commands follow the pattern `make [module.]command`, where the module prefix is optional for the default module (`adeline`).

### Module Namespacing

**Key Architectural Features:**

|Feature|Implementation|Example|
|---|---|---|
|Module Namespace|`<module>.<command>` pattern|`make adeline.services-up`|
|Default Module|Shortcuts map to `adeline`|`make services-up` → `adeline.services-up`|
|Command Aliases|Alternate names for common commands|`make start` → `make run`|
|Color-Coded Output|ANSI color codes for readability|`$(BLUE)`, `$(GREEN)`, `$(YELLOW)`, `$(RED)`|
|Help System|Self-documenting with `## comments`|`make help` auto-generates documentation|

**Sources:** [Makefile1-10](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L1-L10) [Makefile27-48](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L27-L48)

---

## Command Entry Points Mapping

The Makefile commands invoke specific Python entry points. Understanding this mapping is critical for debugging and extending the system.

**Sources:** [Makefile74-77](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L74-L77) [Makefile84-110](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L84-L110) [Makefile115-125](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L115-L125)

---

## Command Categories

### Setup & Installation

Commands for installing dependencies and preparing the development environment.

|Command|Python Entry Point|Description|Prerequisites|
|---|---|---|---|
|`make install`|`uv sync`|Install all project dependencies using uv|None|
|`make install-dev`|`uv sync --all-extras`|Install with development dependencies|None|
|`make upgrade-inference`|`uv sync --upgrade-package inference`|Upgrade Roboflow inference package|None|
|`make check-deps`|`uv pip list --outdated`|Check for outdated dependencies|`make install`|

**Implementation Details:**

- Uses `uv` (ultra-fast Python package installer) instead of pip
- Creates isolated virtual environment in `.venv/`
- Dependency lockfile: `uv.lock`

**Sources:** [Makefile52-69](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L52-L69)

---

### Pipeline Execution

Commands for starting the main inference pipeline. The pipeline **automatically starts** upon launch and begins processing video frames immediately.

|Command|Python Entry Point|Description|Prerequisites|
|---|---|---|---|
|`make run`|`python -m adeline`|Start inference pipeline (auto-starts on launch)|`make install`, `make services-up`|
|`make start`|Alias to `make run`|Alternative name for consistency|Same as `make run`|

**Entry Point Flow:**

**Sources:** [Makefile74-79](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L74-L79) [README.md78-89](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L78-L89)

---

### Control Commands (Runtime)

Commands for controlling a running pipeline via MQTT. These commands require the pipeline to be running and MQTT broker to be available.

|Command|CLI Subcommand|MQTT Topic|Description|Prerequisites|
|---|---|---|---|---|
|`make stop`|`stop`|`inference/control/commands`|Stop pipeline via MQTT|Pipeline running|
|`make pause`|`pause`|`inference/control/commands`|Pause frame processing|Pipeline running|
|`make resume`|`resume`|`inference/control/commands`|Resume frame processing|Pipeline paused|
|`make status`|`status`|`inference/control/commands`|Query pipeline status|Pipeline running|
|`make metrics`|`metrics`|`inference/control/commands`|Request performance metrics|Pipeline running|
|`make toggle-crop`|`toggle_crop`|`inference/control/commands`|Toggle adaptive ROI cropping|Pipeline running|
|`make stabilization-stats`|`stabilization_stats`|`inference/control/commands`|Get stabilization statistics|Pipeline running|

**Command Invocation Pattern:**

All control commands use the same entry point with different subcommands:

```
uv run python -m adeline.control.cli <subcommand>
```

**Control Flow:**

**Sources:** [Makefile84-110](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L84-L110) [README.md84-89](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L84-L89)

---

### Monitoring & Observability

Commands for monitoring detection data streams and pipeline status updates in real-time.

|Command|Python Entry Point|MQTT Topics Subscribed|Description|Prerequisites|
|---|---|---|---|---|
|`make monitor-data`|`python -m adeline.data.monitors data --verbose`|`inference/data/detections`  <br>`inference/data/metrics`|Monitor detection data stream|Pipeline running|
|`make monitor-status`|`python -m adeline.data.monitors status`|`inference/control/status`|Monitor status updates|Pipeline running|
|`make monitor`|Alias to `make monitor-data`|Same as `monitor-data`|Shortcut for data monitoring|Pipeline running|

**Monitor Architecture:**

**Sources:** [Makefile115-125](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L115-L125) [README.md92-102](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L92-L102)

---

### Infrastructure Services

Commands for managing Docker-based infrastructure services (MQTT broker, go2rtc).

|Command|Full Name|Docker Compose File|Description|Prerequisites|
|---|---|---|---|---|
|`make services-up`|`make adeline.services-up`|`docker/adeline/docker-compose.mqtt.yml`|Start MQTT broker (Mosquitto)|Docker installed|
|`make services-down`|`make adeline.services-down`|Same|Stop infrastructure services|Services running|
|`make services-logs`|`make adeline.services-logs`|Same|Show service logs (follow mode)|Services running|
|`make services-status`|`make adeline.services-status`|Same|Check service status|None|

**Service Components:**

**Docker Compose Command Translation:**

- `make services-up` → `docker-compose -f docker/adeline/docker-compose.mqtt.yml up -d`
- `make services-down` → `docker-compose -f docker/adeline/docker-compose.mqtt.yml down`
- `make services-logs` → `docker-compose -f docker/adeline/docker-compose.mqtt.yml logs -f`
- `make services-status` → `docker-compose -f docker/adeline/docker-compose.mqtt.yml ps`

**Sources:** [Makefile130-151](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L130-L151) [README.md183-200](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L183-L200)

---

### Development Tools

Commands for testing, quality checks, and code validation.

|Command|Implementation|Description|Status|
|---|---|---|---|
|`make test`|Echo instructions|Shows manual testing approach|Informational|
|`make test-imports`|Python import checks|Verify all modules can be imported|Functional|
|`make lint`|Placeholder|Linting (not configured)|Not implemented|
|`make format`|Placeholder|Code formatting (not configured)|Not implemented|

**Testing Philosophy:**

This project uses a **manual pair-programming testing approach** rather than automated unit tests. The `make test` command provides instructions:

```
1. Start pipeline: make run
2. Test control: make pause && make resume && make stop
3. Monitor data: make monitor-data
4. Check metrics: make metrics
```

**Import Testing:**

The `make test-imports` command verifies that all core modules can be imported without errors:

```
from adeline import PipelineConfig
from adeline.control import MQTTControlPlane
from adeline.data import MQTTDataPlane
from adeline.inference.roi import ROIBox
from adeline.inference.stabilization import TemporalHysteresisStabilizer
```

**Sources:** [Makefile156-178](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L156-L178) [README.md145-154](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L145-L154)

---

### Cleanup & Maintenance

Commands for cleaning temporary files and removing cached artifacts.

|Command|Targets|Description|Danger Level|
|---|---|---|---|
|`make clean`|`__pycache__/`, `*.pyc`, `*.pyo`, `*.egg-info`|Remove Python cache files|Safe|
|`make clean-venv`|`.venv/` directory|Remove virtual environment|**Requires reinstall**|

**Cleanup Pattern:**

```
# Safe cleanup (run frequently)
find . -type d -name "__pycache__" -exec rm -rf {} +
find . -type f -name "*.pyc" -delete
find . -type f -name "*.pyo" -delete
find . -type d -name "*.egg-info" -exec rm -rf {} +

# Destructive cleanup (requires make install afterwards)
rm -rf .venv
```

**Sources:** [Makefile183-194](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L183-L194)

---

### Documentation & Navigation

Commands for accessing documentation and exploring project structure.

|Command|Output|Description|
|---|---|---|
|`make help`|Formatted help text|Show all available commands with descriptions|
|`make docs` / `make adeline.docs`|Documentation links|List all documentation files|
|`make tree`|Directory tree|Show entire project structure|
|`make adeline.tree`|Package tree|Show adeline package structure|

**Help System Output:**

The help command categorizes commands into sections:

1. Setup & Installation
2. Running Pipeline (Adeline)
3. Infrastructure
4. Monitoring
5. Development

**Sources:** [Makefile27-48](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L27-L48) [Makefile199-218](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L199-L218)

---

### Workflow Shortcuts

Compound commands that execute multiple steps for common workflows.

|Command|Steps Executed|Description|Use Case|
|---|---|---|---|
|`make dev`|`services-up` + `install`|Setup development environment|First-time setup|
|`make full-start`|`services-up` + `run`|Start services and pipeline together|Quick launch|
|`make demo`|`services-up` + background `run`|Start demo with pipeline in background|Demonstrations|

**Workflow: Development Environment Setup**

**Workflow: Quick Demo**

**Sources:** [Makefile223-240](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L223-L240)

---

## Command Dependencies

Understanding command dependencies is critical for successful operation.

### Dependency Graph

### Prerequisite Matrix

|Command|Requires Install|Requires Services|Requires Pipeline|Notes|
|---|---|---|---|---|
|`install`, `clean`, `help`, `docs`|No|No|No|Always available|
|`check-deps`, `test-imports`|Yes|No|No|Needs `.venv/`|
|`run`, `start`|Yes|Yes|No|Starts the pipeline|
|`stop`, `pause`, `resume`|Yes|Yes|Yes|Control running pipeline|
|`status`, `metrics`|Yes|Yes|Yes|Query running pipeline|
|`toggle-crop`, `stabilization-stats`|Yes|Yes|Yes|Runtime configuration|
|`monitor-data`, `monitor-status`|Yes|Yes|Yes|Observe running pipeline|
|`services-*`|No|Varies|No|Infrastructure management|

**Sources:** [Makefile1-240](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L1-L240) [README.md54-103](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L54-L103)

---

## Common Workflows

### Workflow 1: Initial Setup

```
# 1. Install dependencies
make install

# 2. Configure the system
cp config/adeline/config.yaml.example config/adeline/config.yaml
cp .env.example .env
# Edit files as needed

# 3. Start infrastructure
make services-up

# 4. Verify setup
make test-imports
```

### Workflow 2: Running and Controlling Pipeline

```
# Terminal 1: Start pipeline
make run

# Terminal 2: Monitor data
make monitor-data

# Terminal 3: Control pipeline
make pause
make resume
make status
make metrics
make stop
```

### Workflow 3: Development Session

```
# Setup (first time only)
make dev

# Normal operation
make run

# Testing changes (after code edits)
# Ctrl+C to stop pipeline
make test-imports  # Verify imports still work
make run           # Restart pipeline
```

### Workflow 4: Quick Demo

```
# Start everything in demo mode
make demo

# In another terminal, monitor
make monitor-data

# Cleanup when done
make stop
make services-down
```

### Workflow 5: Troubleshooting

```
# Check service status
make services-status

# View service logs
make services-logs

# Verify imports
make test-imports

# Clean and restart
make clean
make services-down
make services-up
make run
```

**Sources:** [README.md54-103](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/README.md#L54-L103) [Makefile223-240](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L223-L240)

---

## Implementation Notes

### UV Package Manager

The Makefile uses `uv` instead of traditional pip for faster dependency management:

- **Variable:** `UV := uv` [Makefile19](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L19-L19)
- **Usage:** `$(UV) sync`, `$(UV) run python -m adeline`
- **Benefits:** 10-100x faster than pip, better dependency resolution

### Python Executable Path

Commands use the UV-managed Python environment:

```
PYTHON := .venv/bin/python
```

However, most commands use `$(UV) run` which automatically activates the virtual environment.

### Color-Coded Output

The Makefile defines ANSI color codes for enhanced readability:

```
BLUE := \033<FileRef file-url="https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/0;34m\nGREEN #LNaN-LNaN" NaN  file-path="0;34m\nGREEN ">Hii</FileRef> <FileRef file-url="https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/Makefile#L130-L151" min=130 max=151 file-path="Makefile">Hii</FileRef>
```