# Entry Points

Relevant source files

- [adeline/CLAUDE.md](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md)
- [adeline/__main__.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/__main__.py)
- [adeline/control/__main__.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control/__main__.py)

This page documents all entry points for the Adeline inference system—the executable modules that serve as interfaces for different system operations. Each entry point corresponds to a distinct operational mode: running the inference pipeline, sending control commands, or monitoring system output.

For information about the commands available through the control CLI entry point, see [Control Commands](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.2-control-commands). For details on the monitoring tools accessible through the monitor entry point, see [Monitoring and Data Streams](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.3-monitoring-and-data-streams). For automation of these entry points via make targets, see [Makefile Command Reference](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.1-makefile-command-reference).

---

## Overview of Entry Points

The Adeline system provides three primary entry points, each serving a distinct purpose in the system's operational architecture:

|Entry Point|Command|Purpose|Module Path|
|---|---|---|---|
|**Main Pipeline**|`python -m adeline`|Runs the inference pipeline with MQTT control and data planes|[adeline/\\_\\_main\\_\\_.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py)|
|**Control CLI**|`python -m adeline.control`|Sends MQTT commands to control a running pipeline|[adeline/control/\\_\\_main\\_\\_.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py)|
|**Data Monitors**|`python -m adeline.data.monitors`|Monitors MQTT data streams (detections, status, metrics)|[adeline/data/monitors/\\_\\_main\\_\\_.py](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/data/monitors///_//_main//_//_.py)|

These entry points operate independently and can run concurrently. The main pipeline is the core system that performs inference and responds to commands. The control CLI and monitors are client utilities that interact with the pipeline via the MQTT broker.

**Sources:** [adeline/CLAUDE.md1-143](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L1-L143)

---

## Entry Point Architecture

This diagram shows how each command-line invocation maps to a specific entry point module, which then delegates to application-level code. All three entry points interact with the same MQTT broker but serve different roles: the main pipeline both publishes and subscribes, the control CLI publishes commands, and the monitors subscribe to data streams.

**Sources:** [adeline/CLAUDE.md138-142](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L138-L142) [adeline/\\_\\_main\\_\\_.py1-8](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L1-L8) [adeline/control/\\_\\_main\\_\\_.py1-7](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py#L1-L7)

---

## Main Pipeline Entry Point

**Command:** `python -m adeline`

**Module Path:** [adeline/\\_\\_main\\_\\_.py1-8](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L1-L8)

### Purpose

The main pipeline entry point starts the complete inference system, including:

- YOLO object detection on RTSP video streams
- MQTT control plane for receiving commands (QoS 1)
- MQTT data plane for publishing detections (QoS 0)
- ROI processing and detection stabilization
- Optional visualization output

This is the primary operational mode of the system. When invoked, it runs continuously until terminated by a stop command (via MQTT) or a signal (SIGINT/SIGTERM).

### Execution Flow

The entry point delegates immediately to `app.main()` ([adeline/\\_\\_main\\_\\_.py4](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L4-L4)), which handles the full initialization sequence. The critical aspect is that `disable_models_from_config()` must execute before importing the inference module to prevent attempting to load disabled models.

**Sources:** [adeline/\\_\\_main\\_\\_.py1-8](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L1-L8) [adeline/CLAUDE.md46-49](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L46-L49) [adeline/CLAUDE.md138-140](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L138-L140)

### Code Path

1. **Entry module**: [adeline/\\_\\_main\\_\\_.py1-8](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L1-L8)
    
    - Imports `main` from `app` module
    - Invokes `main()` when executed
2. **Application controller**: `app/controller.py::main()`
    
    - Loads configuration via `PipelineConfig`
    - Calls `disable_models_from_config()` (critical ordering)
    - Creates `InferencePipelineController` instance
    - Starts the pipeline
3. **Pipeline controller**: `InferencePipelineController`
    
    - Initializes control plane, data plane, and inference pipeline
    - Registers signal handlers for graceful shutdown
    - Coordinates all components during runtime

**Sources:** [adeline/\\_\\_main\\_\\_.py1-8](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L1-L8) [adeline/CLAUDE.md39-42](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L39-L42)

### Usage Context

Use this entry point when:

- Starting the full inference system for production operation
- Running inference with remote MQTT control capability
- Publishing detection results to MQTT subscribers
- Operating the system in a continuous, long-running mode

This entry point is typically invoked via `make run` for convenience (see [Makefile Command Reference](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.1-makefile-command-reference)).

**Sources:** [adeline/CLAUDE.md8-9](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L8-L9)

---

## Control CLI Entry Point

**Command:** `python -m adeline.control`

**Module Path:** [adeline/control/\\_\\_main\\_\\_.py1-7](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py#L1-L7)

### Purpose

The control CLI entry point provides a command-line interface for sending control commands to a running pipeline via MQTT. It acts as a client that publishes commands to the control plane topics and exits immediately after sending the command.

Available commands:

- `pause` - Pause the inference pipeline
- `resume` - Resume a paused pipeline
- `stop` - Gracefully stop the pipeline
- `status` - Request pipeline status
- `toggle_crop` - Toggle ROI cropping on/off (if ROI enabled)
- `stabilization_stats` - Request detection stabilization statistics
- `metrics` - Request watchdog metrics

### Execution Flow

The CLI is a fire-and-forget client. It connects to MQTT, publishes a single command message with QoS 1 (ensuring delivery), and disconnects. The actual command processing happens in the pipeline's control plane subscriber.

**Sources:** [adeline/control/\\_\\_main\\_\\_.py1-7](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py#L1-L7) [adeline/CLAUDE.md27-30](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L27-L30)

### Code Path

1. **Entry module**: [adeline/control/\\_\\_main\\_\\_.py1-7](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py#L1-L7)
    
    - Imports `main` from `control.cli`
    - Invokes `main()` when executed
2. **CLI implementation**: `control/cli.py::main()`
    
    - Parses command-line arguments (command name)
    - Creates MQTT client with temporary client ID
    - Publishes command message to `inference/control/commands` topic
    - Uses QoS 1 for reliable delivery
    - Disconnects after publishing
3. **Command reception**: Pipeline's `MQTTControlPlane`
    
    - Subscribes to `inference/control/commands` with QoS 1
    - Invokes registered callback (e.g., `on_pause`, `on_resume`)
    - Callback modifies pipeline state

**Sources:** [adeline/control/\\_\\_main\\_\\_.py1-7](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py#L1-L7) [adeline/CLAUDE.md12-13](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L12-L13)

### Command Format

Commands are published as JSON payloads:

```
{
  "command": "pause|resume|stop|status|toggle_crop|stabilization_stats|metrics"
}
```

The CLI automatically constructs this payload from the command-line argument. Users only need to specify the command name (e.g., `pause`), not the full JSON structure.

**Sources:** [adeline/CLAUDE.md127-130](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L127-L130)

### Usage Context

Use this entry point when:

- Controlling a running pipeline from the command line
- Scripting pipeline operations (pause before maintenance, resume after)
- Requesting status or metrics information
- Testing pipeline responsiveness to commands

This entry point is typically invoked via make targets: `make pause`, `make resume`, `make stop`, `make status` (see [Makefile Command Reference](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.1-makefile-command-reference)).

**Sources:** [adeline/CLAUDE.md12-13](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L12-L13)

---

## Data Monitors Entry Point

**Command:** `python -m adeline.data.monitors [data|status]`

**Module Path:** `adeline/data/monitors/__main__.py`

### Purpose

The data monitors entry point provides real-time monitoring of MQTT data streams published by the pipeline. It acts as a subscriber client that listens to specific topics and displays received messages to the console. Two monitor modes are available:

- **Data Monitor** (default): Subscribes to `inference/data/detections` and `inference/data/metrics`, displaying detection results and performance metrics
- **Status Monitor**: Subscribes to `inference/control/status`, displaying pipeline status updates and control plane messages

### Execution Flow

The monitors run continuously until interrupted by the user (Ctrl+C). They use appropriate QoS levels matching the topics they subscribe to: QoS 0 for data plane topics (performance-oriented), QoS 1 for control plane topics (reliability-oriented).

**Sources:** [adeline/CLAUDE.md16-18](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L16-L18)

### Code Path

1. **Entry module**: `adeline/data/monitors/__main__.py`
    
    - Parses command-line argument for monitor mode (`data` or `status`)
    - Defaults to `data` mode if no argument provided
    - Calls appropriate monitor function
2. **Monitor implementation**: `data/monitors/__main__.py::main()`
    
    - Creates MQTT client with subscriber role
    - Subscribes to appropriate topics based on mode
    - Registers message callback for formatting and display
    - Runs message loop until interrupted
3. **Data sources**: Pipeline's `MQTTDataPlane` and `MQTTControlPlane`
    
    - Data plane publishes detections and metrics (QoS 0)
    - Control plane publishes status updates (QoS 1)

**Sources:** [adeline/CLAUDE.md16-18](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L16-L18)

### Monitor Modes

|Mode|Topics|QoS|Purpose|
|---|---|---|---|
|**data** (default)|`inference/data/detections`  <br>`inference/data/metrics`|0|Monitor detection results and performance metrics in real-time|
|**status**|`inference/control/status`|1|Monitor pipeline state changes and control plane messages|

### Usage Context

Use this entry point when:

- Debugging inference results and verifying detection accuracy
- Monitoring system performance and throughput metrics
- Observing pipeline state transitions during control operations
- Developing or testing new features that publish to MQTT

This entry point is typically invoked via `make monitor-data` or `make monitor-status` for convenience (see [Makefile Command Reference](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.1-makefile-command-reference)).

**Sources:** [adeline/CLAUDE.md16-18](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L16-L18)

---

## Entry Point Interaction Patterns

The three entry points work together to provide a complete operational interface:

**Typical Usage Sequence:**

1. **Start infrastructure** (MQTT broker): `make services-up`
2. **Start main pipeline**: `python -m adeline` (or `make run`)
3. **Start monitors** (in separate terminal): `python -m adeline.data.monitors` (or `make monitor-data`)
4. **Send control commands** (as needed): `python -m adeline.control pause` (or `make pause`)
5. **Verify state changes** via monitor output

This separation allows independent scaling: multiple monitors can connect to observe the same pipeline, and control commands can be sent from any client.

**Sources:** [adeline/CLAUDE.md8-19](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L8-L19)

---

## Entry Point Module Structure

Each entry point follows the Python `-m` module execution pattern, where `__main__.py` serves as the entry module for a package:

|Entry Point|Entry Module|Delegation Target|Core Implementation|
|---|---|---|---|
|`python -m adeline`|`adeline/__main__.py`|`adeline.app.main()`|`app/controller.py`|
|`python -m adeline.control`|`adeline/control/__main__.py`|`adeline.control.cli.main()`|`control/cli.py`|
|`python -m adeline.data.monitors`|`adeline/data/monitors/__main__.py`|Local `main()` function|`data/monitors/__main__.py`|

The entry modules are intentionally minimal ([adeline/\\_\\_main\\_\\_.py1-8](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L1-L8) [adeline/control/\\_\\_main\\_\\_.py1-7](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py#L1-L7)), containing only import and delegation logic. This keeps the entry point logic separate from the application logic, improving testability and module organization.

**Sources:** [adeline/\\_\\_main\\_\\_.py1-8](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L1-L8) [adeline/control/\\_\\_main\\_\\_.py1-7](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py#L1-L7) [adeline/CLAUDE.md138-142](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L138-L142)

---

## Summary

The Adeline inference system provides three distinct entry points, each serving a specific operational role:

- **Main Pipeline** (`python -m adeline`): The core system that performs inference, manages control/data planes, and coordinates all components
- **Control CLI** (`python -m adeline.control`): A lightweight client for sending commands to control the pipeline
- **Data Monitors** (`python -m adeline.data.monitors`): Subscribers for observing real-time data streams and status updates

These entry points communicate exclusively via MQTT, enabling distributed operation where the control CLI and monitors can run on different machines from the main pipeline. The clear separation of concerns—inference vs. control vs. monitoring—allows each component to be developed, tested, and deployed independently.

For detailed information on the main pipeline's orchestration logic, see [Pipeline Controller](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/5.1-pipeline-controller). For the complete command reference, see [Control Commands](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.2-control-commands). For monitoring capabilities, see [Monitoring and Data Streams](https://deepwiki.com/care-foundation/kata-inference-251021-clean2/7.3-monitoring-and-data-streams).

**Sources:** [adeline/CLAUDE.md1-143](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/CLAUDE.md#L1-L143) [adeline/\\_\\_main\\_\\_.py1-8](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline///_//_main//_//_.py#L1-L8) [adeline/control/\\_\\_main\\_\\_.py1-7](https://github.com/care-foundation/kata-inference-251021-clean2/blob/9a713ffb/adeline/control///_//_main//_//_.py#L1-L7)